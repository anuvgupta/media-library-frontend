<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Streamy</title>
        <meta name="author" content="Anuv Gupta" />
        <meta name="copyright" content="Copyright (c) 2025 Anuv Gupta" />
        <meta name="description" content="Share movies with friends" />
        <link id="favicon" rel="icon" type="image/x-icon" href="/favicon.ico" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <%= getInitScript() %>
    </head>
    <body>
        <h1>Streamy</h1>

        <!-- Status Messages -->
        <div id="status-message" style="opacity: 1">Welcome to Streamy!</div>

        <!-- Loading View -->
        <div id="loading-view">
            <h2>Loading...</h2>
            <p>Please wait...</p>
        </div>

        <!-- Sign In View -->
        <div id="signin-view" style="display: none">
            <h2>Sign In</h2>
            <p>Please sign in to access your movie library.</p>

            <form onsubmit="return false;">
                <div>
                    <label for="username">Username or Email:</label><br />
                    <input
                        type="text"
                        id="username"
                        placeholder="Enter your username or email"
                    />
                </div>
                <br />
                <div>
                    <label for="password">Password:</label><br />
                    <input
                        type="password"
                        id="password"
                        placeholder="Enter your password"
                    />
                </div>
                <br />
                <button id="login-btn">Sign In</button>
            </form>

            <br />
            <p>
                Don't have an account?
                <button id="show-signup-btn">Sign Up</button>
            </p>
        </div>

        <!-- Sign Up View -->
        <div id="signup-view" style="display: none">
            <h2>Sign Up</h2>
            <p>Create a new account to get started.</p>

            <form onsubmit="return false;">
                <div>
                    <label for="signup-username">Username:</label><br />
                    <input
                        type="text"
                        id="signup-username"
                        placeholder="Choose a username"
                    />
                </div>
                <br />
                <div>
                    <label for="signup-email">Email:</label><br />
                    <input
                        type="email"
                        id="signup-email"
                        placeholder="Enter your email address"
                    />
                </div>
                <br />
                <div>
                    <label for="signup-password">Password:</label><br />
                    <input
                        type="password"
                        id="signup-password"
                        placeholder="Choose a secure password"
                    />
                </div>
                <br />
                <button id="signup-btn">Create Account</button>
            </form>
            <br />
            <p>
                Already have a verification code?
                <button id="goto-verify-btn">Verify</button>
            </p>
            <p>
                Already have an account?
                <button id="show-signin-btn">Sign In</button>
            </p>
        </div>

        <!-- Email Verification View -->
        <div id="verification-view" style="display: none">
            <h2>Verify Your Email</h2>
            <p>
                We've sent a verification code to your email address. Please
                enter it below to complete your account setup.
            </p>

            <form onsubmit="return false;">
                <div>
                    <label for="verification-username">Username:</label><br />
                    <input
                        type="text"
                        id="verification-username"
                        placeholder="Enter your current username"
                    />
                </div>
                <br />
                <div>
                    <label for="verification-password">Password:</label><br />
                    <input
                        type="password"
                        id="verification-password"
                        placeholder="Enter your current password"
                    />
                </div>
                <br />
                <div>
                    <label for="verification-code">Verification Code:</label
                    ><br />
                    <input
                        type="text"
                        id="verification-code"
                        placeholder="Enter the 6-digit code from your email"
                    />
                </div>
                <br />
                <button id="verify-btn">Verify Email</button>
                <button id="resend-code-btn">Resend Code</button>
            </form>

            <br />
            <p><button id="back-to-signin-btn">Back to Sign In</button></p>
        </div>

        <!-- Libraries View -->
        <div id="libraries-view" style="display: none">
            <!-- Account Section -->
            <div class="account-section">
                <h3>Account</h3>
                <div class="account-section-content"></div>
                <button class="logout-btn" id="logout-btn-libraries">
                    Sign Out
                </button>
            </div>

            <div class="section-spacer"></div>

            <hr />

            <div class="section-spacer"></div>
            <div class="section-spacer"></div>

            <!-- Libraries Section -->
            <div>
                <h2>Libraries</h2>
                <p>
                    Here are the movie libraries you have access to. This
                    includes libraries you own and libraries that have been
                    shared with you.
                </p>

                <div id="libraries-list">
                    <p>Loading libraries...</p>
                </div>
            </div>
        </div>

        <!-- Library View -->
        <div id="library-view" style="display: none">
            <!-- Account Section -->
            <div class="account-section">
                <h3>Account</h3>
                <div class="account-section-content"></div>
                <button class="logout-btn" id="logout-btn-library">
                    Sign Out
                </button>
            </div>

            <br />

            <!-- <div class="section-spacer"></div> -->

            <button id="back-to-libraries-btn">← Back to Libraries</button>

            <div class="section-spacer"></div>

            <hr />

            <div class="section-spacer"></div>
            <div class="section-spacer"></div>

            <!-- Library Management Section (only shown if user owns the library) -->
            <div id="library-management-section" style="display: none">
                <h2>Manage</h2>
                <p>Manage your library.</p>

                <h3>Index</h3>
                <p>
                    Refresh the library index to scan for new movies and update
                    metadata:
                </p>
                <button
                    id="refresh-index-btn"
                    onclick="window.mediaLibraryApp.refreshLibraryIndex()"
                >
                    Refresh Index
                </button>
                <br /><br />

                <h3>Share</h3>
                <p>
                    Enter a username or email address to share this library with
                    another user:
                </p>
                <form class="share-form" onsubmit="return false;">
                    <div class="share-form-inner-container">
                        <label for="share-with-input">Username or Email:</label>
                        <!-- <br /> -->
                        <input
                            type="text"
                            id="share-with-input"
                            placeholder="Enter username or email address"
                        />
                    </div>
                    <br />
                    <button id="share-library-btn">Share Library</button>
                </form>

                <div class="shared-with-header">
                    <h4>Shared With</h4>
                    <button id="refresh-shared-users-btn">Refresh List</button>
                </div>
                <div id="shared-users-list">
                    <p>Loading shared users...</p>
                </div>
                <br />
                <hr />
                <div class="section-spacer"></div>
                <div class="section-spacer"></div>
            </div>

            <!-- Library Viewing Section -->
            <div>
                <div
                    style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 10px;
                    "
                >
                    <h2>Library</h2>
                    <button
                        id="refresh-library-btn"
                        onclick="window.mediaLibraryApp.refreshLibraryContent()"
                    >
                        Refresh
                    </button>
                </div>
                <p>Browse the movies and collections in this library.</p>

                <div id="library-content">
                    <p>Loading library contents...</p>
                </div>
                <br />
            </div>
        </div>
        <!-- Movie View -->
        <div id="movie-view" style="display: none">
            <!-- Account Section -->
            <div class="account-section">
                <h3>Account</h3>
                <div class="account-section-content"></div>
                <button class="logout-btn" id="logout-btn-movie">
                    Sign Out
                </button>
            </div>

            <br />

            <!-- <div class="section-spacer"></div> -->

            <button id="back-to-library-btn">← Back to Library</button>

            <div class="section-spacer"></div>

            <hr />

            <div class="section-spacer"></div>
            <div class="section-spacer"></div>

            <!-- Movie Content Section -->
            <div>
                <h2 id="movie-title">Movie Title</h2>

                <!-- Video Player -->
                <div class="player-container" style="margin-bottom: 20px">
                    <!-- Play Button Overlay -->
                    <div
                        class="play-button-overlay"
                        id="play-button-overlay"
                        style="
                            position: absolute;
                            top: 0;
                            left: 0;
                            right: 0;
                            bottom: 0;
                            background: rgba(0, 0, 0, 0.8);
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                            z-index: 15;
                            cursor: pointer;
                            transition: opacity 0.3s ease;
                        "
                    >
                        <div
                            class="play-button"
                            style="
                                width: 80px;
                                height: 80px;
                                background: rgba(255, 255, 255, 0.9);
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                margin-bottom: 15px;
                                transition: all 0.2s ease;
                            "
                        >
                            <div
                                style="
                                    width: 0;
                                    height: 0;
                                    border-left: 25px solid #000;
                                    border-top: 15px solid transparent;
                                    border-bottom: 15px solid transparent;
                                    margin-left: 5px;
                                "
                            ></div>
                        </div>
                        <div
                            style="
                                color: #fff;
                                font-size: 18px;
                                font-weight: 500;
                            "
                        >
                            Click to Play
                        </div>
                    </div>

                    <video
                        id="video-player"
                        controls
                        preload="none"
                        style="
                            width: 100%;
                            height: auto;
                            min-height: 400px;
                            background: #000;
                            outline: none;
                        "
                        poster="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 675'%3E%3Crect width='1200' height='675' fill='%23111'/%3E%3C/svg%3E"
                    >
                        Your browser does not support the video tag.
                    </video>

                    <div
                        class="loading-overlay hidden"
                        id="loading-overlay"
                        style="
                            position: absolute;
                            top: 0;
                            left: 0;
                            right: 0;
                            bottom: 0;
                            background: rgba(0, 0, 0, 0.8);
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                            z-index: 10;
                            transition: opacity 0.3s ease;
                        "
                    >
                        <div
                            class="spinner"
                            style="
                                width: 50px;
                                height: 50px;
                                border: 3px solid #333;
                                border-top: 3px solid #fff;
                                border-radius: 50%;
                                animation: spin 1s linear infinite;
                                margin-bottom: 20px;
                            "
                        ></div>
                        <div
                            class="loading-text"
                            id="loading-text"
                            style="
                                font-size: 18px;
                                color: #ccc;
                                text-align: center;
                            "
                        >
                            Loading video...
                        </div>
                    </div>

                    <!-- <div
                        class="quality-selector"
                        id="quality-selector"
                        style="
                            position: absolute;
                            top: 15px;
                            right: 15px;
                            z-index: 20;
                            display: none;
                        "
                    >
                        <select
                            id="quality-select"
                            style="
                                background: rgba(0, 0, 0, 0.7);
                                color: white;
                                border: 1px solid #444;
                                padding: 5px 10px;
                                border-radius: 4px;
                                font-size: 12px;
                            "
                        >
                            <option value="auto">Auto Quality</option>
                        </select>
                    </div> -->
                </div>

                <div
                    class="subtitle-controls"
                    style="margin-bottom: 20px; display: none"
                    id="subtitle-controls"
                >
                    <h4>Subtitles</h4>
                    <div class="subtitle-control-row">
                        <label for="subtitle-track-select">Track:</label>
                        <select id="subtitle-track-select">
                            <option value="-1">No Subtitles</option>
                        </select>
                    </div>
                    <div class="subtitle-control-row">
                        <label for="subtitle-offset">Timing Offset:</label>
                        <input
                            type="number"
                            id="subtitle-offset"
                            min="-30"
                            max="30"
                            step="0.1"
                            value="0"
                        />
                        <span>seconds</span>
                        <button id="apply-subtitle-offset">Apply</button>
                        <button id="reset-subtitle-offset">Reset</button>
                    </div>
                </div>

                <div
                    id="movie-status-bar"
                    class="movie-status-bar hidden"
                    style="margin-bottom: 20px"
                >
                    <div class="status-content">
                        <div class="status-text">
                            <span id="status-message-text"
                                >Processing movie...</span
                            >
                            <span id="status-percentage">0%</span>
                        </div>
                        <div class="status-progress-bar">
                            <div
                                id="status-progress-fill"
                                class="status-progress-fill"
                                style="width: 0%"
                            ></div>
                        </div>
                        <div class="status-details">
                            <span id="status-eta"></span>
                            <span id="status-stage"></span>
                        </div>
                    </div>
                </div>

                <!-- Movie Details -->
                <div id="movie-details-container" style="margin-bottom: 20px">
                    <div id="poster-container"></div>
                    <div id="movie-details-content">
                        <p>
                            <strong>Year:</strong>
                            <span id="movie-year">Unknown</span>
                        </p>
                        <p>
                            <strong>Runtime:</strong>
                            <span id="movie-runtime">Unknown</span>
                        </p>
                        <p>
                            <strong>Quality:</strong>
                            <span id="movie-quality">Unknown</span>
                        </p>

                        <!-- Description Section -->

                        <div>
                            <strong>Description:</strong>
                            <p id="movie-description">Loading...</p>
                        </div>
                    </div>
                </div>

                <br />

                <div class="section-spacer"></div>
            </div>
        </div>

        <div class="theme-toggle-bar">
            <button class="theme-toggle" aria-label="Change theme">
                <svg
                    class="theme-icon sun-icon"
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                >
                    <circle cx="12" cy="12" r="5" />
                    <path
                        d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                    />
                </svg>
                <svg
                    class="theme-icon moon-icon"
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                >
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                </svg>
                <svg
                    class="theme-icon gear-icon"
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                >
                    <circle cx="12" cy="12" r="3"></circle>
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
                    ></path>
                </svg>
            </button>
        </div>
    </body>
</html>
